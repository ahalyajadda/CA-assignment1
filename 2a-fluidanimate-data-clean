import pandas as pd
 
# Read CSV, skip comment lines and blank lines
df = pd.read_csv("perf_output.csv", header=None, comment="#", skip_blank_lines=True)
 
# Keep only rows that have at least 4 non-NaN values
df = df.dropna(thresh=4)
 
# Select the columns we need: Time (0), Count (1), Event (3)
df = df[[0,1,3]]
df.columns = ["Time","Count","Event"]
 
# Drop rows where Event is NaN
df = df.dropna(subset=["Event"])
 
# Remove rows where Count is "<not counted>"
df = df[df["Count"] != "<not counted>"]
 
# Remove commas from Count and convert to numeric
df["Count"] = pd.to_numeric(df["Count"].astype(str).str.replace(',', ''), errors='coerce')
 
# Drop rows where conversion failed
df = df.dropna(subset=["Count"])
 
# Clean Event names: remove slashes and spaces
df["Event"] = df["Event"].str.strip().str.replace('/', '_', regex=True)
 
# Pivot table: one row per Time, columns = events
df_pivot = df.pivot_table(index="Time", columns="Event", values="Count", aggfunc="sum").reset_index()
 
# Sort by Time
df_pivot = df_pivot.sort_values("Time")
 
# Save reshaped CSV
df_pivot.to_csv("fluidanimate_clean.csv", index=False)
print("âœ… Reshaped CSV saved as fluidanimate_clean.csv")
 
